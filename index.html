<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetabolicRx NutritionAI | Personalized Meal Planning</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Previous CSS remains the same until the results-header */
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        #generate-grocery-list {
            width: auto;
            padding: 0.75rem 1.5rem;
            white-space: nowrap;
        }
        
        /* Add this new style for the servings input in grocery modal */
        .grocery-servings-input {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .grocery-servings-input input {
            width: 60px;
            padding: 0.5rem;
            text-align: center;
        }
        
        /* Keep all other existing styles the same */
    </style>
</head>
<body>
    <!-- Previous HTML remains the same until the grocery list modal -->
    
    <!-- Grocery List Modal -->
    <div class="grocery-list-modal" id="grocery-list-modal">
        <div class="grocery-list-content">
            <div class="modal-header">
                <h3 class="modal-title">Your Grocery List</h3>
                <button class="close-modal" id="close-grocery-modal">&times;</button>
            </div>
            
            <div class="grocery-servings-input">
                <label for="grocery-servings">Shopping for:</label>
                <input type="number" id="grocery-servings" min="1" max="20" value="1">
                <span>person(s)</span>
            </div>
            
            <div class="recipe-section">
                <ul class="grocery-list" id="grocery-list">
                    <!-- Grocery items will be added here -->
                </ul>
            </div>
            
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="print-grocery-list">
                    <i class="fas fa-print"></i> Print List
                </button>
                <button class="modal-btn modal-btn-primary" id="close-grocery-list">
                    Done
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Previous JavaScript remains the same until the generateGroceryList function

        function generateGroceryList() {
            const servings = parseInt(document.getElementById('grocery-servings').value) || 1;
            groceryList.innerHTML = '';
            
            // Conversion factors for raw to cooked (example values)
            const conversionFactors = {
                'quinoa': {rawToCooked: 0.5, unit: 'cup'}, // 1/2 cup raw = 1 cup cooked
                'rice': {rawToCooked: 0.5, unit: 'cup'},
                'pasta': {rawToCooked: 0.5, unit: 'cup'},
                'oats': {rawToCooked: 0.5, unit: 'cup'}
            };
            
            // Aggregate all ingredients
            const allIngredients = {};
            
            currentMealPlan.forEach(meal => {
                meal.ingredients.forEach(ingredient => {
                    const itemLower = ingredient.item.toLowerCase();
                    const key = itemLower.replace(/[^a-z ]/g, '').trim();
                    
                    // Check if this is a cooked ingredient that needs conversion
                    let convertedAmount = parseFloat(ingredient.amount) || 0;
                    let unit = '';
                    let itemName = ingredient.item;
                    
                    // Apply conversion if needed
                    for (const food in conversionFactors) {
                        if (itemLower.includes(food) && itemLower.includes('cooked')) {
                            const factor = conversionFactors[food];
                            convertedAmount = convertedAmount * factor.rawToCooked;
                            unit = factor.unit;
                            itemName = itemName.replace('cooked', 'raw').replace(/\d+\.?\d*\s*\w*\s*/g, '').trim();
                            itemName = `${factor.unit} ${itemName}`;
                            break;
                        }
                    }
                    
                    if (allIngredients[key]) {
                        allIngredients[key].amount += convertedAmount * servings;
                    } else {
                        allIngredients[key] = {
                            amount: convertedAmount * servings,
                            unit: unit,
                            item: itemName
                        };
                    }
                });
            });
            
            // Display the grocery list
            for (const key in allIngredients) {
                const item = allIngredients[key];
                const li = document.createElement('li');
                
                if (item.amount > 0) {
                    li.textContent = `${formatAmount(item.amount)} ${item.item}`;
                } else {
                    li.textContent = item.item;
                }
                
                groceryList.appendChild(li);
            }
            
            groceryListModal.style.display = 'flex';
        }
        
        // Update the print functionality
        printGroceryList.addEventListener('click', function() {
            const printWindow = window.open('', '', 'width=600,height=600');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Grocery List</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h1 { color: #5E35B1; }
                            ul { columns: 2; column-gap: 20px; }
                            li { margin-bottom: 8px; break-inside: avoid; }
                        </style>
                    </head>
                    <body>
                        <h1>Grocery List</h1>
                        <ul>
                            ${Array.from(groceryList.children).map(li => `<li>${li.textContent}</li>`).join('')}
                        </ul>
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() { window.close(); }, 100);
                            };
                        </script>
                    </body>
                </html>
            `);
            printWindow.document.close();
        });

        // Update the meal templates to ensure 56 unique meals (14 days x 4 meals)
        const uniqueMeals = {
            breakfast: [
                {name: 'Avocado and Spinach Omelet with Whole Grain Toast', time: '8:00 AM', description: 'Fluffy omelet packed with healthy fats and fiber', calories: '450', protein: '22g', carbs: '35g', ingredients: [{amount: '2', item: 'large eggs'}, {amount: '0.25', item: 'cup fresh spinach, chopped'}, {amount: '0.25', item: 'avocado, sliced'}, {amount: '1', item: 'slice whole grain bread'}, {amount: '1', item: 'tsp olive oil'}, {amount: '', item: 'Salt and pepper to taste'}]},
                {name: 'Greek Yogurt Parfait with Granola and Berries', time: '8:00 AM', description: 'Creamy yogurt with crunchy granola and fresh berries', calories: '400', protein: '18g', carbs: '45g', ingredients: [{amount: '1', item: 'cup Greek yogurt'}, {amount: '0.5', item: 'cup mixed berries'}, {amount: '0.25', item: 'cup granola'}, {amount: '1', item: 'tsp honey'}]},
                {name: 'Scrambled Eggs with Whole Wheat Toast', time: '8:00 AM', description: 'Fluffy scrambled eggs with fiber-rich toast', calories: '350', protein: '20g', carbs: '30g', ingredients: [{amount: '2', item: 'large eggs'}, {amount: '1', item: 'slice whole wheat bread'}, {amount: '1', item: 'tsp butter'}]},
                {name: 'Oatmeal with Almond Butter and Banana', time: '8:00 AM', description: 'Warm oats with healthy fats and potassium', calories: '380', protein: '12g', carbs: '55g', ingredients: [{amount: '0.5', item: 'cup raw oats'}, {amount: '1', item: 'cup water'}, {amount: '1', item: 'tbsp almond butter'}, {amount: '0.5', item: 'banana, sliced'}]},
                {name: 'Smoothie Bowl with Chia Seeds', time: '8:00 AM', description: 'Thick smoothie topped with superfood seeds', calories: '420', protein: '15g', carbs: '50g', ingredients: [{amount: '1', item: 'cup frozen mixed berries'}, {amount: '1', item: 'banana'}, {amount: '0.5', item: 'cup almond milk'}, {amount: '1', item: 'tbsp chia seeds'}]},
                {name: 'Breakfast Burrito with Black Beans', time: '8:00 AM', description: 'Protein-packed wrap to start your day', calories: '480', protein: '25g', carbs: '45g', ingredients: [{amount: '2', item: 'large eggs'}, {amount: '0.25', item: 'cup black beans'}, {amount: '1', item: 'whole wheat tortilla'}, {amount: '0.25', item: 'avocado'}]},
                {name: 'Protein Pancakes with Blueberries', time: '8:00 AM', description: 'Fluffy pancakes with antioxidant-rich berries', calories: '410', protein: '30g', carbs: '40g', ingredients: [{amount: '0.5', item: 'cup protein pancake mix'}, {amount: '0.5', item: 'cup almond milk'}, {amount: '0.5', item: 'cup blueberries'}]},
                {name: 'Chia Pudding with Coconut Flakes', time: '8:00 AM', description: 'Overnight chia pudding with tropical flavor', calories: '390', protein: '10g', carbs: '35g', ingredients: [{amount: '2', item: 'tbsp chia seeds'}, {amount: '1', item: 'cup almond milk'}, {amount: '1', item: 'tbsp coconut flakes'}]},
                {name: 'Breakfast Quinoa with Cinnamon', time: '8:00 AM', description: 'Protein-rich alternative to oatmeal', calories: '370', protein: '12g', carbs: '55g', ingredients: [{amount: '0.5', item: 'cup raw quinoa'}, {amount: '1', item: 'cup almond milk'}, {amount: '1', item: 'tsp cinnamon'}]},
                {name: 'Veggie Breakfast Muffins', time: '8:00 AM', description: 'Portable veggie-packed egg muffins', calories: '320', protein: '20g', carbs: '25g', ingredients: [{amount: '3', item: 'large eggs'}, {amount: '0.5', item: 'cup chopped bell peppers'}, {amount: '0.5', item: 'cup chopped spinach'}]},
                {name: 'Almond Butter Toast with Flaxseed', time: '8:00 AM', description: 'Simple toast with healthy fats', calories: '350', protein: '12g', carbs: '35g', ingredients: [{amount: '2', item: 'slices whole grain bread'}, {amount: '2', item: 'tbsp almond butter'}, {amount: '1', item: 'tsp flaxseeds'}]},
                {name: 'Breakfast Tofu Scramble', time: '8:00 AM', description: 'Plant-based protein scramble', calories: '300', protein: '20g', carbs: '15g', ingredients: [{amount: '0.5', item: 'block firm tofu'}, {amount: '0.5', item: 'cup chopped vegetables'}, {amount: '1', item: 'tsp turmeric'}]},
                {name: 'Cottage Cheese with Pineapple', time: '8:00 AM', description: 'High-protein dairy with tropical fruit', calories: '280', protein: '25g', carbs: '25g', ingredients: [{amount: '1', item: 'cup cottage cheese'}, {amount: '0.5', item: 'cup pineapple chunks'}]},
                {name: 'Buckwheat Porridge with Walnuts', time: '8:00 AM', description: 'Nutty alternative to traditional porridge', calories: '400', protein: '15g', carbs: '45g', ingredients: [{amount: '0.5', item: 'cup raw buckwheat groats'}, {amount: '1', item: 'cup water'}, {amount: '0.25', item: 'cup walnuts'}]}
            ],
            lunch: [
                {name: 'Grilled Chicken Salad with Balsamic Vinaigrette', time: '12:30 PM', description: 'Protein-rich salad with mixed greens and light dressing', calories: '550', protein: '40g', carbs: '20g', ingredients: [{amount: '4', item: 'oz grilled chicken breast'}, {amount: '2', item: 'cups mixed greens'}, {amount: '0.5', item: 'cup cherry tomatoes'}, {amount: '0.5', item: 'cup cucumber slices'}, {amount: '1', item: 'tbsp balsamic vinaigrette'}]},
                {name: 'Turkey and Avocado Wrap', time: '12:30 PM', description: 'Lean protein with healthy fats in a whole grain wrap', calories: '500', protein: '35g', carbs: '30g', ingredients: [{amount: '1', item: 'whole grain tortilla'}, {amount: '3', item: 'oz turkey breast'}, {amount: '0.25', item: 'avocado'}, {amount: '1', item: 'leaf lettuce'}]},
                {name: 'Quinoa Salad with Chickpeas and Vegetables', time: '12:30 PM', description: 'Plant-based protein with fresh vegetables', calories: '450', protein: '15g', carbs: '60g', ingredients: [{amount: '0.5', item: 'cup cooked quinoa'}, {amount: '0.5', item: 'cup chickpeas'}, {amount: '0.5', item: 'cup mixed vegetables'}]},
                {name: 'Salmon and Brown Rice Bowl', time: '12:30 PM', description: 'Omega-3 rich meal with complex carbs', calories: '600', protein: '35g', carbs: '55g', ingredients: [{amount: '1', item: 'salmon fillet (4 oz)'}, {amount: '0.5', item: 'cup cooked brown rice'}, {amount: '0.5', item: 'cup steamed broccoli'}]},
                {name: 'Lentil Soup with Whole Grain Bread', time: '12:30 PM', description: 'Fiber-rich plant-based protein soup', calories: '480', protein: '25g', carbs: '65g', ingredients: [{amount: '1.5', item: 'cups lentil soup'}, {amount: '1', item: 'slice whole grain bread'}]},
                {name: 'Tuna Salad with Mixed Greens', time: '12:30 PM', description: 'Lean protein with healthy fats and greens', calories: '520', protein: '40g', carbs: '15g', ingredients: [{amount: '1', item: 'can tuna in water'}, {amount: '1', item: 'tbsp olive oil'}, {amount: '2', item: 'cups mixed greens'}]},
                {name: 'Vegetable Stir Fry with Tofu', time: '12:30 PM', description: 'Plant-based protein with colorful vegetables', calories: '500', protein: '25g', carbs: '40g', ingredients: [{amount: '0.5', item: 'block firm tofu'}, {amount: '1.5', item: 'cups mixed vegetables'}, {amount: '1', item: 'tbsp soy sauce'}]},
                {name: 'Chicken and Vegetable Wrap', time: '12:30 PM', description: 'Lean protein with fiber-rich vegetables', calories: '480', protein: '35g', carbs: '45g', ingredients: [{amount: '1', item: 'whole wheat tortilla'}, {amount: '3', item: 'oz grilled chicken'}, {amount: '0.5', item: 'cup mixed vegetables'}]},
                {name: 'Egg Salad with Whole Grain Crackers', time: '12:30 PM', description: 'Protein-rich salad with whole grains', calories: '450', protein: '20g', carbs: '35g', ingredients: [{amount: '2', item: 'hard boiled eggs'}, {amount: '1', item: 'tbsp Greek yogurt'}, {amount: '10', item: 'whole grain crackers'}]},
                {name: 'Black Bean and Sweet Potato Bowl', time: '12:30 PM', description: 'Fiber-rich plant-based meal', calories: '520', protein: '18g', carbs: '85g', ingredients: [{amount: '0.5', item: 'cup black beans'}, {amount: '0.5', item: 'cup roasted sweet potato'}, {amount: '0.25', item: 'avocado'}]},
                {name: 'Greek Salad with Grilled Shrimp', time: '12:30 PM', description: 'Mediterranean flavors with lean protein', calories: '480', protein: '35g', carbs: '25g', ingredients: [{amount: '4', item: 'oz grilled shrimp'}, {amount: '1', item: 'cup chopped cucumber'}, {amount: '0.5', item: 'cup cherry tomatoes'}, {amount: '0.25', item: 'cup feta cheese'}]},
                {name: 'Chicken Caesar Salad (Light)', time: '12:30 PM', description: 'Classic salad with lighter dressing', calories: '450', protein: '40g', carbs: '20g', ingredients: [{amount: '4', item: 'oz grilled chicken'}, {amount: '2', item: 'cups romaine lettuce'}, {amount: '1', item: 'tbsp light Caesar dressing'}]},
                {name: 'Veggie Burger with Sweet Potato Fries', time: '12:30 PM', description: 'Plant-based protein with antioxidant-rich side', calories: '550', protein: '20g', carbs: '70g', ingredients: [{amount: '1', item: 'veggie burger patty'}, {amount: '1', item: 'whole wheat bun'}, {amount: '0.5', item: 'cup baked sweet potato fries'}]},
                {name: 'Mediterranean Chickpea Salad', time: '12:30 PM', description: 'Fiber-rich salad with Mediterranean flavors', calories: '480', protein: '15g', carbs: '60g', ingredients: [{amount: '0.75', item: 'cup chickpeas'}, {amount: '0.5', item: 'cup chopped cucumber'}, {amount: '0.5', item: 'cup cherry tomatoes'}, {amount: '0.25', item: 'cup feta cheese'}]}
            ],
            dinner: [
                {name: 'Baked Salmon with Quinoa and Roasted Asparagus', time: '6:30 PM', description: 'Heart-healthy omega-3s with complex carbs', calories: '600', protein: '45g', carbs: '40g', ingredients: [{amount: '1', item: 'salmon fillet (6 oz)'}, {amount: '0.5', item: 'cup cooked quinoa'}, {amount: '1', item: 'cup asparagus spears'}, {amount: '1', item: 'tbsp olive oil'}, {amount: '', item: 'Lemon wedges for serving'}]},
                {name: 'Grilled Chicken with Roasted Vegetables', time: '6:30 PM', description: 'Lean protein with antioxidant-rich vegetables', calories: '550', protein: '50g', carbs: '25g', ingredients: [{amount: '1', item: 'chicken breast'}, {amount: '1', item: 'cup mixed vegetables'}, {amount: '1', item: 'tbsp olive oil'}]},
                {name: 'Vegetable Stir Fry with Tofu', time: '6:30 PM', description: 'Plant-based protein with colorful vegetables', calories: '500', protein: '25g', carbs: '40g', ingredients: [{amount: '0.5', item: 'block firm tofu'}, {amount: '1.5', item: 'cups mixed vegetables'}, {amount: '1', item: 'tbsp soy sauce'}]},
                {name: 'Turkey Meatballs with Zucchini Noodles', time: '6:30 PM', description: 'Lean protein with low-carb vegetable noodles', calories: '520', protein: '45g', carbs: '25g', ingredients: [{amount: '4', item: 'turkey meatballs'}, {amount: '1', item: 'medium zucchini, spiralized'}, {amount: '0.5', item: 'cup marinara sauce'}]},
                {name: 'Shrimp and Vegetable Skewers with Brown Rice', time: '6:30 PM', description: 'Lean seafood with fiber-rich sides', calories: '580', protein: '40g', carbs: '55g', ingredients: [{amount: '6', item: 'large shrimp'}, {amount: '1', item: 'cup mixed vegetables'}, {amount: '0.5', item: 'cup cooked brown rice'}]},
                {name: 'Lentil Curry with Cauliflower Rice', time: '6:30 PM', description: 'Plant-based protein with low-carb rice alternative', calories: '500', protein: '25g', carbs: '60g', ingredients: [{amount: '0.75', item: 'cup cooked lentils'}, {amount: '1', item: 'cup cauliflower rice'}, {amount: '0.5', item: 'cup coconut milk'}]},
                {name: 'Beef and Broccoli Stir Fry', time: '6:30 PM', description: 'Iron-rich protein with cruciferous vegetable', calories: '550', protein: '45g', carbs: '35g', ingredients: [{amount: '4', item: 'oz lean beef strips'}, {amount: '1.5', item: 'cups broccoli florets'}, {amount: '1', item: 'tbsp stir-fry sauce'}]},
                {name: 'Baked Cod with Lemon and Roasted Potatoes', time: '6:30 PM', description: 'Lean white fish with complex carbs', calories: '520', protein: '40g', carbs: '45g', ingredients: [{amount: '1', item: 'cod fillet (6 oz)'}, {amount: '0.5', item: 'cup roasted potatoes'}, {amount: '1', item: 'lemon wedge'}]},
                {name: 'Chicken and Vegetable Kebabs with Couscous', time: '6:30 PM', description: 'Lean protein with Mediterranean flavors', calories: '580', protein: '45g', carbs: '50g', ingredients: [{amount: '4', item: 'oz chicken breast cubes'}, {amount: '1', item: 'cup mixed vegetables'}, {amount: '0.5', item: 'cup cooked couscous'}]},
                {name: 'Stuffed Bell Peppers with Ground Turkey', time: '6:30 PM', description: 'Lean protein with fiber-rich vegetable vessel', calories: '500', protein: '40g', carbs: '35g', ingredients: [{amount: '2', item: 'bell peppers'}, {amount: '4', item: 'oz ground turkey'}, {amount: '0.5', item: 'cup cooked quinoa'}]},
                {name: 'Eggplant Parmesan (Light)', time: '6:30 PM', description: 'Vegetarian option with lighter preparation', calories: '480', protein: '25g', carbs: '45g', ingredients: [{amount: '4', item: 'slices eggplant'}, {amount: '0.5', item: 'cup marinara sauce'}, {amount: '0.25', item: 'cup part-skim mozzarella'}]},
                {name: 'Pork Tenderloin with Roasted Brussels Sprouts', time: '6:30 PM', description: 'Lean protein with cruciferous vegetable', calories: '520', protein: '50g', carbs: '25g', ingredients: [{amount: '4', item: 'oz pork tenderloin'}, {amount: '1', item: 'cup Brussels sprouts'}, {amount: '1', item: 'tsp olive oil'}]},
                {name: 'Vegetable Lasagna with Lean Ground Beef', time: '6:30 PM', description: 'Classic dish with added vegetables', calories: '550', protein: '40g', carbs: '45g', ingredients: [{amount: '1', item: 'slice vegetable lasagna'}, {amount: '2', item: 'oz lean ground beef'}, {amount: '0.5', item: 'cup marinara sauce'}]},
                {name: 'Mushroom and Spinach Stuffed Chicken', time: '6:30 PM', description: 'Lean protein with antioxidant-rich filling', calories: '500', protein: '55g', carbs: '15g', ingredients: [{amount: '1', item: 'chicken breast'}, {amount: '0.5', item: 'cup chopped mushrooms'}, {amount: '0.5', item: 'cup fresh spinach'}]}
            ],
            snack: [
                {name: 'Greek Yogurt with Mixed Berries and Almonds', time: '3:00 PM', description: 'Protein-packed snack with antioxidants', calories: '250', protein: '15g', carbs: '20g', ingredients: [{amount: '1', item: 'cup Greek yogurt'}, {amount: '0.5', item: 'cup mixed berries'}, {amount: '0.25', item: 'cup almonds'}]},
                {name: 'Apple Slices with Almond Butter', time: '3:00 PM', description: 'Fiber-rich fruit with healthy fats', calories: '200', protein: '5g', carbs: '25g', ingredients: [{amount: '1', item: 'medium apple'}, {amount: '1', item: 'tbsp almond butter'}]},
                {name: 'Handful of Mixed Nuts', time: '3:00 PM', description: 'Healthy fats and plant-based protein', calories: '250', protein: '8g', carbs: '10g', ingredients: [{amount: '0.25', item: 'cup mixed nuts'}]},
                {name: 'Carrot Sticks with Hummus', time: '3:00 PM', description: 'Fiber-rich vegetables with plant protein', calories: '180', protein: '6g', carbs: '20g', ingredients: [{amount: '1', item: 'cup carrot sticks'}, {amount: '0.25', item: 'cup hummus'}]},
                {name: 'Cottage Cheese with Pineapple', time: '3:00 PM', description: 'High-protein dairy with tropical fruit', calories: '180', protein: '20g', carbs: '15g', ingredients: [{amount: '0.5', item: 'cup cottage cheese'}, {amount: '0.5', item: 'cup pineapple chunks'}]},
                {name: 'Hard Boiled Eggs with Sea Salt', time: '3:00 PM', description: 'Protein-packed portable snack', calories: '140', protein: '12g', carbs: '1g', ingredients: [{amount: '2', item: 'hard boiled eggs'}, {amount: '', item: 'Pinch of sea salt'}]},
                {name: 'Protein Smoothie', time: '3:00 PM', description: 'Quick and nutritious liquid snack', calories: '220', protein: '25g', carbs: '20g', ingredients: [{amount: '1', item: 'scoop protein powder'}, {amount: '1', item: 'cup almond milk'}, {amount: '0.5', item: 'banana'}]},
                {name: 'Rice Cakes with Peanut Butter', time: '3:00 PM', description: 'Crunchy snack with healthy fats', calories: '200', protein: '8g', carbs: '25g', ingredients: [{amount: '2', item: 'rice cakes'}, {amount: '1', item: 'tbsp peanut butter'}]},
                {name: 'Edamame with Sea Salt', time: '3:00 PM', description: 'Plant-based protein snack', calories: '190', protein: '15g', carbs: '15g', ingredients: [{amount: '0.5', item: 'cup edamame pods'}, {amount: '', item: 'Pinch of sea salt'}]},
                {name: 'Dark Chocolate and Almonds', time: '3:00 PM', description: 'Antioxidant-rich treat with healthy fats', calories: '220', protein: '5g', carbs: '15g', ingredients: [{amount: '1', item: 'oz dark chocolate'}, {amount: '0.25', item: 'cup almonds'}]},
                {name: 'Celery Sticks with Peanut Butter', time: '3:00 PM', description: 'Crunchy vegetable with protein-rich spread', calories: '180', protein: '7g', carbs: '15g', ingredients: [{amount: '2', item: 'celery stalks'}, {amount: '1', item: 'tbsp peanut butter'}]},
                {name: 'Turkey and Cheese Roll-ups', time: '3:00 PM', description: 'Protein-packed finger food', calories: '200', protein: '20g', carbs: '2g', ingredients: [{amount: '2', item: 'slices turkey breast'}, {amount: '1', item: 'slice cheese'}]},
                {name: 'Roasted Chickpeas', time: '3:00 PM', description: 'Crunchy plant-based protein snack', calories: '150', protein: '7g', carbs: '20g', ingredients: [{amount: '0.5', item: 'cup roasted chickpeas'}]},
                {name: 'Avocado Toast on Whole Grain', time: '3:00 PM', description: 'Healthy fats with complex carbs', calories: '220', protein: '6g', carbs: '20g', ingredients: [{amount: '1', item: 'slice whole grain bread'}, {amount: '0.25', item: 'avocado'}]}
            ]
        };

        // Update the displaySampleMealPlan function to ensure unique meals
        function displaySampleMealPlan(formData, apiActive) {
            currentMealPlan = [];
            let mealPlanHTML = '';
            const days = parseInt(formData.days);
            const mealsPerDay = [];
            
            // Determine which meals to include each day
            if (formData.meals.breakfast) mealsPerDay.push('breakfast');
            if (formData.meals.lunch) mealsPerDay.push('lunch');
            if (formData.meals.dinner) mealsPerDay.push('dinner');
            if (formData.meals.snacks) mealsPerDay.push('snack');
            
            if (apiActive) {
                mealPlanHTML += '<div style="margin-bottom: 1rem; color: var(--secondary); font-size: 0.875rem;"><i class="fas fa-check-circle"></i> Powered by Google AI</div>';
            }
            
            // Create a copy of meal options that we can modify
            const availableMeals = JSON.parse(JSON.stringify(uniqueMeals));
            
            for (let i = 1; i <= days; i++) {
                const dayName = new Date(Date.now() + (i * 24 * 60 * 60 * 1000)).toLocaleDateString('en-US', { weekday: 'long' });
                
                mealPlanHTML += `
                    <div class="day">
                        <div class="day-header">Day ${i}: ${dayName}</div>
                `;
                
                // For each meal type, select a unique option
                mealsPerDay.forEach(mealType => {
                    // If we've run out of unique options, reset the array
                    if (availableMeals[mealType].length === 0) {
                        availableMeals[mealType] = JSON.parse(JSON.stringify(uniqueMeals[mealType]));
                    }
                    
                    // Select a random meal from remaining options
                    const randomIndex = Math.floor(Math.random() * availableMeals[mealType].length);
                    const meal = availableMeals[mealType][randomIndex];
                    
                    // Remove this meal from available options
                    availableMeals[mealType].splice(randomIndex, 1);
                    
                    const mealId = `meal-${i}-${mealType}`;
                    currentMealPlan.push({
                        id: mealId,
                        type: mealType,
                        name: meal.name,
                        ingredients: meal.ingredients
                    });
                    
                    mealPlanHTML += `
                        <div class="meal" id="${mealId}" onclick="showRecipeDetail('${meal.name}', ${i}, '${mealType}', '${formData.allergies}', '${formData.medication}')">
                            <button class="replace-meal-btn" onclick="replaceMeal(event, '${mealId}', '${mealType}')">
                                <i class="fas fa-sync-alt"></i> Replace
                            </button>
                            <div class="meal-header">
                                <div class="meal-type">${mealType}</div>
                                <div class="meal-time">${meal.time}</div>
                            </div>
                            <div class="meal-name">${meal.name}</div>
                            <div class="meal-description">
                                ${meal.description}${formData.allergies ? ' (Allergy-aware)' : ''}${formData.medication !== 'none' ? ' (Medication-adjusted)' : ''}
                            </div>
                            <div class="meal-nutrition">
                                <div class="nutrition-item"><span>Calories:</span> <span>${meal.calories}</span></div>
                                <div class="nutrition-item"><span>Protein:</span> <span>${meal.protein}</span></div>
                                <div class="nutrition-item"><span>Carbs:</span> <span>${meal.carbs}</span></div>
                            </div>
                        </div>
                    `;
                });
                
                mealPlanHTML += `</div>`;
            }
            
            mealPlanElement.innerHTML = mealPlanHTML;
            mealPlanElement.style.display = 'block';
        }

        // Keep all other existing JavaScript functions the same
    </script>
</body>
</html>